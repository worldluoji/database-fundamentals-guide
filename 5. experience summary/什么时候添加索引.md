# 什么时候添加索引
在MySQL中，为数据表添加索引的决策不仅取决于单表数据量，还需结合查询频率、字段特性及业务场景综合判断。以下是关键判断标准和实践建议：

---

### 📊 **一、核心数据量阈值**
1. **基础建议（300-2000行）**  
   - **超过300行**：若表频繁用于查询（尤其是WHERE、JOIN、ORDER BY子句），建议为关键字段加索引。  
   - **超过2000行**：**强烈建议评估并添加索引**，避免全表扫描导致性能瓶颈。

2. **大表场景（10万行以上）**  
   - 数据量超过10万行时，索引对查询性能的提升至关重要。此时未加索引的查询可能显著拖慢系统。

---

### ⚙️ **二、其他需加索引的情况**
即使数据量较小，符合以下条件也应添加索引：  
1. **高频查询字段**：WHERE子句中频繁出现的字段（如`user_id`、`order_date`）。  
2. **连接字段（JOIN操作）**：外键关联字段必须建索引，优化多表查询效率。  
3. **排序与分组字段**：ORDER BY、GROUP BY、DISTINCT涉及的列（如`create_time`）。  
4. **高选择性字段**：  
   - 唯一值比例高（如用户ID、手机号）的字段建索引效果显著；  
   - 低选择性字段（如性别、状态标志）建索引收益低，需谨慎。

---

### ⚠️ **三、无需或避免加索引的情况**
1. **小表（<300行）**：全表扫描效率更高，索引反而增加维护成本。  
2. **频繁更新的字段**：索引会降低INSERT/UPDATE/DELETE速度，需权衡读写比例。  
3. **大文本字段**：避免对`TEXT`/`BLOB`类型建全文索引（可用前缀索引替代）。  
4. **冗余索引**：  
   - 联合索引`(a,b)`已覆盖字段`a`时，单独索引`a`是冗余的；  
   - 单表索引数建议控制在**5个以内**，定期清理未使用索引。

---

### 🛠️ **四、索引优化最佳实践**
| **策略**                | **说明**                                                                 |
|-------------------------|--------------------------------------------------------------------------|
| **复合索引设计**         | 按查询条件顺序创建联合索引（如`(department, salary)`），遵循最左前缀原则。 |
| **覆盖索引**            | 索引包含查询所需字段（如`SELECT name FROM users`，索引`(name)`），避免回表。 |
| **前缀索引优化**        | 对长字符字段（如地址）取前N个字符建索引，平衡效率与空间。               |
| **监控与调优**          | 使用`EXPLAIN`分析查询计划，监控慢日志，定期优化碎片化索引。             |

---

### 💎 **五、总结建议**
- **300行是起点**：数据量超300行且涉及查询时，开始评估索引需求。  
- **2000行是临界点**：超过后必须为高频字段添加索引。  
- **业务场景优先**：即使数据量小，高频查询、连接字段也需索引；反之，低选择性或频繁更新的字段应规避索引。  
- **持续优化**：定期审查索引使用率（如MySQL的`sys.schema_unused_indexes`），避免过度索引。

> 示例：用户表`users`（50万行）中，为`WHERE`条件`city`和`ORDER BY`字段`create_time`创建联合索引`idx_city_time(city, create_time)`，查询速度提升10倍以上。

通过上述策略，可显著提升查询性能，同时避免索引滥用导致的写入性能下降和存储浪费。