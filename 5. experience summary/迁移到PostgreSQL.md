# 迁移到PostgreSQL
从 MySQL 迁移到 PostgreSQL 需要重点关注以下差异和核心知识点：

---

### **一、数据类型差异**
1. **数组类型**  
   PostgreSQL 支持 `ARRAY` 类型（如 `INT[]`, `TEXT[]`），可直接存储数组，MySQL 需用 JSON 或关联表模拟。
2. **JSON/JSONB**  
   PostgreSQL 的 `JSONB` 提供二进制存储和索引支持，性能优于 MySQL 的 JSON。
3. **网络地址类型**  
   支持 `INET`, `CIDR`, `MACADDR` 等网络类型，MySQL 需用字符串存储。
4. **范围类型**  
   `RANGE` 类型（如 `INT4RANGE`, `TSRANGE`）支持范围查询，MySQL 需手动处理。
5. **无符号整数**  
   PostgreSQL 没有 `UNSIGNED` 类型，需用 `CHECK` 约束限制范围。

---

### **二、SQL 语法差异**
1. **字符串拼接**  
   使用 `||` 代替 MySQL 的 `CONCAT()`（如 `SELECT 'a' || 'b'`）。
2. **ILIKE 不区分大小写匹配**  
   用 `ILIKE` 替代 MySQL 的默认不区分大小写 `LIKE`。
3. **分页查询**  
   类似 MySQL 的 `LIMIT n OFFSET m`，但优化方式不同（避免深度分页性能问题）。
4. **CTE 和递归查询**  
   支持 `WITH RECURSIVE` 实现复杂递归逻辑，MySQL 8.0+ 也支持但优化策略不同。
5. **RETURNING 子句**  
   DML 语句后可用 `RETURNING` 返回受影响的数据（如 `DELETE ... RETURNING *`）。

---

### **三、事务与 DDL**
1. **事务性 DDL**  
   PostgreSQL 的 DDL（如 `CREATE TABLE`）可以包含在事务中，MySQL 的 DDL 自动提交。
2. **MVCC 并发控制**  
   采用多版本并发控制（类似 MySQL InnoDB），但实现细节不同（如无回滚段）。
3. **VACUUM 机制**  
   定期清理死元组以释放空间（自动 `AUTOVACUUM`），需避免表膨胀。

---

### **四、约束与索引**
1. **EXCLUDE 约束**  
   唯一性约束的高级形式（如确保时间段不重叠）。
2. **部分索引（Partial Index）**  
   可对数据子集创建索引（如 `CREATE INDEX ... WHERE status = 'active'`）。
3. **表达式索引**  
   索引可基于函数或表达式（如 `CREATE INDEX ... ON tbl (LOWER(name))`）。

---

### **五、函数与存储过程**
1. **PL/pgSQL 语言**  
   存储过程使用 PL/pgSQL 编写（语法类似 Oracle），不同于 MySQL 的 `BEGIN...END` 风格。
2. **自定义函数**  
   支持多种语言（如 Python、JavaScript 通过扩展）。
3. **窗口函数**  
   更强大的窗口函数支持（如 `ROW_NUMBER()`, `RANK()`）。

---

### **六、权限管理**
1. **角色系统**  
   使用 `ROLE` 管理权限，支持角色继承（`INHERIT`），类似 MySQL 8.0 的角色。
2. **细粒度权限**  
   可针对表、列、序列等对象授权（如 `GRANT SELECT(column) ON table TO role`）。

---

### **七、工具与配置**
1. **命令行工具**  
   使用 `psql` 代替 `mysql`，支持元命令（如 `\d` 查看表结构，`\df` 查看函数）。
2. **配置文件**  
   主配置 `postgresql.conf`，客户端认证 `pg_hba.conf`。
3. **备份与恢复**  
   使用 `pg_dump`（逻辑备份）和 `pg_basebackup`（物理备份），支持并行备份。

---

### **八、高级特性**
1. **表继承（Inheritance）**  
   子表继承父表结构，适用于分区场景（但声明式分区更推荐）。
2. **FDW（外部数据包装器）**  
   支持跨数据库查询（如 MySQL、MongoDB）。
3. **扩展（Extensions）**  
   通过 `CREATE EXTENSION` 加载插件（如 `PostGIS`、`pgcrypto`）。

---

### **九、迁移注意事项**
1. **大小写敏感**  
   表名和列名默认小写，如需保留大小写需用双引号（如 `"MyTable"`）。
2. **自增主键**  
   使用 `SERIAL` 或 `GENERATED BY DEFAULT AS IDENTITY`，而非 `AUTO_INCREMENT`。
3. **隐式提交**  
   避免依赖 MySQL 的隐式提交行为，PostgreSQL 需显式事务控制。

---

### **十、学习资源**
1. **官方文档**  
   [PostgreSQL Documentation](https://www.postgresql.org/docs/)
2. **交互教程**  
   [PGExercises](https://pgexercises.com/)
3. **书籍推荐**  
   《PostgreSQL 实战》《The Art of PostgreSQL》

---

掌握以上内容后，可通过实际项目逐步熟悉 PostgreSQL 的最佳实践和性能调优技巧（如执行计划分析、索引优化）。